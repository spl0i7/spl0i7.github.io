<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Over the course of years , I have encountered many interesting tools which anonymous skids use to wreak havoc over the internet. One such tool in torshammer, Written in python. Torshammer is slow HTTP">
<meta property="og:type" content="article">
<meta property="og:title" content="Torshammer , script kiddies favorite tool">
<meta property="og:url" content="http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/index.html">
<meta property="og:site_name" content="Ketansingh.net">
<meta property="og:description" content="Over the course of years , I have encountered many interesting tools which anonymous skids use to wreak havoc over the internet. One such tool in torshammer, Written in python. Torshammer is slow HTTP">
<meta property="og:image" content="https://i.imgur.com/BsOfxfn.png">
<meta property="og:image" content="https://i.imgur.com/Q3LzY0i.png">
<meta property="og:image" content="https://i.imgur.com/8ylC6sA.png">
<meta property="og:image" content="https://i.imgur.com/EKKZqKu.png">
<meta property="og:image" content="https://i.imgur.com/AXx12VB.png">
<meta property="og:image" content="https://i.imgur.com/bdrRjd9.png">
<meta property="og:image" content="https://i.imgur.com/Dp7GN6R.png">
<meta property="og:image" content="https://i.imgur.com/el33QDh.png">
<meta property="og:updated_time" content="2016-06-04T03:47:58.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Torshammer , script kiddies favorite tool">
<meta name="twitter:description" content="Over the course of years , I have encountered many interesting tools which anonymous skids use to wreak havoc over the internet. One such tool in torshammer, Written in python. Torshammer is slow HTTP">
<meta name="twitter:image" content="https://i.imgur.com/BsOfxfn.png">
<meta name="twitter:creator" content="@http://twitter.com/sh_ketan">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Torshammer , script kiddies favorite tool</title>
    <!-- styles -->
    <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/lib/meslo-LG/styles.css">
    <link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
    <!-- jquery -->
    <script src="/lib/jquery/jquery.min.js"></script>
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/spl0i7">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/hacking-games-with-dll-injection/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li>
        
        
        <li><a class="icon" href="/pwning-with-seh-based-buffer-overflows/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/&text=Torshammer , script kiddies favorite tool"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/&title=Torshammer , script kiddies favorite tool"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/&is_video=false&description=Torshammer , script kiddies favorite tool"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Torshammer , script kiddies favorite tool&body=Check out this article: http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/&title=Torshammer , script kiddies favorite tool"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/&title=Torshammer , script kiddies favorite tool"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/&title=Torshammer , script kiddies favorite tool"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/&title=Torshammer , script kiddies favorite tool"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/&name=Torshammer , script kiddies favorite tool&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#How-it-works"><span class="toc-number">1.</span> <span class="toc-text">How it works?</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Analyzing-the-Code"><span class="toc-number">1.1.</span> <span class="toc-text">Analyzing the Code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Run-time-Analysis"><span class="toc-number">1.2.</span> <span class="toc-text">Run-time Analysis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mitigation"><span class="toc-number">1.3.</span> <span class="toc-text">Mitigation</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Torshammer , script kiddies favorite tool
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Ketansingh.net</span>
      </span>
      
    <div class="postdate">
        <time datetime="2016-03-29T22:59:21.000Z" itemprop="datePublished">2016-03-30</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/exploit/">exploit</a>, <a class="tag-link" href="/tags/networking/">networking</a>, <a class="tag-link" href="/tags/programming/">programming</a>, <a class="tag-link" href="/tags/python/">python</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>Over the course of years , I have encountered many interesting tools which anonymous skids use to wreak havoc over the internet. One such tool in torshammer, Written in python. Torshammer is slow HTTP POST DoS tool , meaning  it can possibly bring a webserver down using maliciously crafted HTTP requests even with a single machine without much bandwidth. It mostly works with apache and IIS and can be used over tor , hiding real attacker. It’s author has described this tool as</p>
<p><strong>Tor’s Hammer is a slow post dos testing tool written in Python. It can also be run through the Tor network to be anonymized. Kills most unprotected web servers running Apache and IIS via a single instance. Kills Apache 1.X and older IIS with ~128 threads, newer IIS and Apache 2.X with ~256 threads.</strong></p>
<h1 id="How-it-works"><a href="#How-it-works" class="headerlink" title="How it works?"></a>How it works?</h1><p>Torshammer executes a DoS attack by using a slow POST attack, where POST content is transmitted in slow rates under the same session (actual rates are randomly chosen within the limit of 0.1-3 seconds).It will generate number of HTTP POST request and establish the connection to the server If server can’t close the connection correctly, it will get a lot of current connection at same time and lot of child processes/thread will be spawned. Inside of each of connection, it is just only sending some randomize characters to maintain the established connection. When the attack hit the maximum of child process/thread that server can open, it will no longer serve the legitimate traffic and will become unavailable.</p>
<p>This tool does not need to generate huge attack bandwidth and high HTTP request per second. Just need to hold the maxim current connection that server can handle which makes this tool very dangerous.</p>
<h2 id="Analyzing-the-Code"><a href="#Analyzing-the-Code" class="headerlink" title="Analyzing the Code"></a>Analyzing the Code</h2><p>I have forked <a href="https://github.com/spl0i7/torshammer" target="_blank" rel="external">torshammer</a> on my github repository. As you can see it consists of three files -</p>
<p><code>torshammer.py</code> - This file contains all the code needed  to generate malicious packets.</p>
<p><code>socks.py</code> - This serves as a module to provide tunneling through socks proxy (TOR).</p>
<p><code>terminal.py</code> - This is also a module to generate formatted output to terminal.</p>
<p>Torshammer selects one of these 20 user-agents while sending POST HTTP requests to the server , thus making it little bit difficult to distinguish from legitimate traffic.<br><img src="https://i.imgur.com/BsOfxfn.png" alt="useragent"></p>
<p>It also spawns threads for each connection it tries to make to the server using <code>Thread</code> class from <code>threading</code> module in python.</p>
<p><img src="https://i.imgur.com/Q3LzY0i.png" alt="threading"></p>
<p>then it keeps sending random data to target server to prevent connection from getting closed using<br><img src="https://i.imgur.com/8ylC6sA.png" alt="post"></p>
<p>and</p>
<p><img src="https://i.imgur.com/EKKZqKu.png" alt="alive"></p>
<p>Note that also send  <code>Keep-Alive : 900</code> . This is way it can keep connection <code>ESTABLISHED</code> and prevent server from closing the socket.T o make things more random it delays packet transmission from <code>0.1</code> to <code>3</code> seconds.</p>
<h2 id="Run-time-Analysis"><a href="#Run-time-Analysis" class="headerlink" title="Run-time Analysis"></a>Run-time Analysis</h2><p>Suppose our target webserver is located at <code>192.168.56.101</code>. Target machine is Ubuntu 14.04 with <code>apache2.4.7</code> with default configuration.</p>
<p><img src="https://i.imgur.com/AXx12VB.png" alt="target"></p>
<p>Let’s fire the missiles.</p>
<p><img src="https://i.imgur.com/bdrRjd9.png" alt="fire"></p>
<p>At this point server will become unavailable in a matter of few seconds.</p>
<p><code>netstat</code> in target machine shows it has opened too many connection to port 80 as we expected</p>
<p><img src="https://i.imgur.com/Dp7GN6R.png" alt="netstat"></p>
<p>Wireshark confirms what we saw in code.It keeps sending HTTP POST requests along with random <code>character+number</code></p>
<p><img src="https://i.imgur.com/el33QDh.png" alt="wireshark"></p>
<h2 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h2><p>For Denial-of-Service attacks, there is no true solution, only mitigation</p>
<p>1) Limiting maximum of 20 connection to a user rendered this attack ineffective.</p>
<p><code>iptables -A INPUT -p tcp --syn --dport 80 -m connlimit --connlimit-above 20 -j DROP</code></p>
<p>This method will work for DoS and not DDoS .It can possibly interfere legitimate users in certain cases. </p>
<p>2) Use <code>mod_reqtimeout</code></p>
<p>Using <code>RequestReadTimeout</code> directive allows you to specify different thresholds for receiving request data. We can add <code>RequestReadTimeout header=30, body=30</code> in apache configuration for this module. This places a threshold of 30 seconds to completely receive the request body data. If the data is not received by that time, Apache will issue a 408 Request-Timeout status code.</p>
<p>3) Use <code>mod_qos</code></p>
<p>This is used for mechanisms that can provide different levels of priority to different HTTP requests. We can add following to this module’s configuration<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># limit maximum connection per IP to 30</div><div class="line">QS_SrvMaxConnPerIP 30</div><div class="line"># limit maximum TCP connections to 256</div><div class="line">MaxClients 256</div><div class="line"># disables keep-alive when 160/256 TCP connections are occupied</div><div class="line">QS_SrvMaxConnClose 160</div><div class="line"># minimum request/response speed</div><div class="line">QS_SrvMinDataRate 150 1200</div></pre></td></tr></table></figure></p>
<p>Sources:<br><a href="https://www.acunetix.com/blog/articles/slow-http-dos-attacks-mitigate-apache-http-server/" target="_blank" rel="external">https://www.acunetix.com/blog/articles/slow-http-dos-attacks-mitigate-apache-http-server/</a></p>
<p><a href="https://www.trustwave.com/Resources/SpiderLabs-Blog/(Updated)-ModSecurity-Advanced-Topic-of-the-Week--Mitigating-Slow-HTTP-DoS-Attacks/" target="_blank" rel="external">https://www.trustwave.com/Resources/SpiderLabs-Blog/(Updated)-ModSecurity-Advanced-Topic-of-the-Week--Mitigating-Slow-HTTP-DoS-Attacks/</a></p>
<p><a href="https://berb.github.io/diploma-thesis/original/042_serverarch.html" target="_blank" rel="external">https://berb.github.io/diploma-thesis/original/042_serverarch.html</a></p>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/spl0i7">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#How-it-works"><span class="toc-number">1.</span> <span class="toc-text">How it works?</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Analyzing-the-Code"><span class="toc-number">1.1.</span> <span class="toc-text">Analyzing the Code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Run-time-Analysis"><span class="toc-number">1.2.</span> <span class="toc-text">Run-time Analysis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mitigation"><span class="toc-number">1.3.</span> <span class="toc-text">Mitigation</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/&text=Torshammer , script kiddies favorite tool"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/&title=Torshammer , script kiddies favorite tool"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/&is_video=false&description=Torshammer , script kiddies favorite tool"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Torshammer , script kiddies favorite tool&body=Check out this article: http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/&title=Torshammer , script kiddies favorite tool"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/&title=Torshammer , script kiddies favorite tool"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/&title=Torshammer , script kiddies favorite tool"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/&title=Torshammer , script kiddies favorite tool"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://ketansingh.net/analyzing-script-kiddies-tool-torshammer/&name=Torshammer , script kiddies favorite tool&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2017 Ketan Singh
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/spl0i7">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    <script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-47868439-2', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->


</body>
</html>
